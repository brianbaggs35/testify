<% content_for :title, "Search Results" %>

<div class="mb-8">
  <h1 class="text-3xl font-bold text-gray-900 mb-2">Search Results</h1>
  <% if @query.present? %>
    <p class="text-lg text-gray-600">
      Found <span class="font-semibold text-indigo-600"><%= @total_results %></span> results for 
      "<span class="font-medium"><%= @query %></span>"
    </p>
  <% else %>
    <p class="text-lg text-gray-600">Enter a search term to find test cases, suites, runs, and uploads.</p>
  <% end %>
</div>

<!-- Search Form -->
<div class="bg-white shadow-xl rounded-2xl p-6 mb-8">
  <%= form_with url: search_path, method: :get, local: true, class: "relative" do |form| %>
    <div class="relative">
      <%= form.text_field :q, 
            value: @query,
            placeholder: "Search test cases, suites, runs, and uploads...", 
            class: "w-full pl-12 pr-4 py-4 text-lg border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-all duration-200",
            autocomplete: "off" %>
      <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
        <svg class="h-6 w-6 text-gray-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
      </div>
      <%= form.submit "Search", 
            class: "absolute right-2 top-2 bottom-2 bg-gradient-to-r from-indigo-500 to-indigo-600 hover:from-indigo-600 hover:to-indigo-700 text-white px-6 rounded-lg font-semibold transition-all duration-200 transform hover:scale-105" %>
    </div>
  <% end %>
</div>

<% if @query.present? && @total_results > 0 %>
  <!-- Results Grid -->
  <div class="space-y-8">
    <!-- Test Cases -->
    <% if @results[:test_cases].any? %>
      <div class="bg-white shadow-xl rounded-2xl overflow-hidden">
        <div class="bg-gradient-to-r from-blue-500 to-indigo-600 px-6 py-4">
          <div class="flex items-center justify-between">
            <h2 class="text-xl font-bold text-white flex items-center">
              <svg class="h-6 w-6 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
              </svg>
              Test Cases (<%= @results[:test_cases].count %>)
            </h2>
            <%= link_to test_cases_path(search: @query), class: "bg-white/20 hover:bg-white/30 text-white px-3 py-1 rounded-lg text-sm font-medium transition-all duration-200" do %>
              View All →
            <% end %>
          </div>
        </div>
        <div class="p-6">
          <div class="space-y-4">
            <% @results[:test_cases].each do |test_case| %>
              <div class="p-4 bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl hover:from-blue-100 hover:to-indigo-100 transition-all duration-200 border border-blue-200">
                <div class="flex items-start justify-between">
                  <div class="flex-1">
                    <h3 class="font-semibold text-gray-900 mb-1">
                      <%= link_to test_case.title, test_case_path(test_case), class: "hover:text-indigo-600 transition-colors" %>
                    </h3>
                    <p class="text-sm text-gray-600 mb-2"><%= truncate(test_case.description, length: 150) %></p>
                    <div class="flex items-center space-x-3 text-xs">
                      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                        <%= test_case.priority %>
                      </span>
                      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                        <%= test_case.status %>
                      </span>
                      <span class="text-gray-500">Updated <%= time_ago_in_words(test_case.updated_at) %> ago</span>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>

    <!-- Test Suites -->
    <% if @results[:test_suites].any? %>
      <div class="bg-white shadow-xl rounded-2xl overflow-hidden">
        <div class="bg-gradient-to-r from-emerald-500 to-green-600 px-6 py-4">
          <div class="flex items-center justify-between">
            <h2 class="text-xl font-bold text-white flex items-center">
              <svg class="h-6 w-6 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10" />
              </svg>
              Test Suites (<%= @results[:test_suites].count %>)
            </h2>
            <%= link_to test_suites_path(search: @query), class: "bg-white/20 hover:bg-white/30 text-white px-3 py-1 rounded-lg text-sm font-medium transition-all duration-200" do %>
              View All →
            <% end %>
          </div>
        </div>
        <div class="p-6">
          <div class="space-y-4">
            <% @results[:test_suites].each do |test_suite| %>
              <div class="p-4 bg-gradient-to-r from-emerald-50 to-green-50 rounded-xl hover:from-emerald-100 hover:to-green-100 transition-all duration-200 border border-emerald-200">
                <div class="flex items-start justify-between">
                  <div class="flex-1">
                    <h3 class="font-semibold text-gray-900 mb-1">
                      <%= link_to test_suite.name, test_suite_path(test_suite), class: "hover:text-emerald-600 transition-colors" %>
                    </h3>
                    <p class="text-sm text-gray-600 mb-2"><%= truncate(test_suite.description, length: 150) %></p>
                    <div class="flex items-center space-x-3 text-xs text-gray-500">
                      <span><%= test_suite.test_cases.count %> test cases</span>
                      <span>•</span>
                      <span>Updated <%= time_ago_in_words(test_suite.updated_at) %> ago</span>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>

    <!-- Test Runs -->
    <% if @results[:test_runs].any? %>
      <div class="bg-white shadow-xl rounded-2xl overflow-hidden">
        <div class="bg-gradient-to-r from-purple-500 to-violet-600 px-6 py-4">
          <div class="flex items-center justify-between">
            <h2 class="text-xl font-bold text-white flex items-center">
              <svg class="h-6 w-6 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h1m4 0h1m-6 4h1m4 0h1m6-10V7a3 3 0 11-6 0V4h6zM4 20h16" />
              </svg>
              Test Runs (<%= @results[:test_runs].count %>)
            </h2>
            <%= link_to test_runs_path(search: @query), class: "bg-white/20 hover:bg-white/30 text-white px-3 py-1 rounded-lg text-sm font-medium transition-all duration-200" do %>
              View All →
            <% end %>
          </div>
        </div>
        <div class="p-6">
          <div class="space-y-4">
            <% @results[:test_runs].each do |test_run| %>
              <div class="p-4 bg-gradient-to-r from-purple-50 to-violet-50 rounded-xl hover:from-purple-100 hover:to-violet-100 transition-all duration-200 border border-purple-200">
                <div class="flex items-start justify-between">
                  <div class="flex-1">
                    <h3 class="font-semibold text-gray-900 mb-1">
                      <%= link_to test_run.name, test_run_path(test_run), class: "hover:text-purple-600 transition-colors" %>
                    </h3>
                    <p class="text-sm text-gray-600 mb-2"><%= truncate(test_run.notes, length: 150) if test_run.notes.present? %></p>
                    <div class="flex items-center space-x-3 text-xs">
                      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800">
                        <%= test_run.status %>
                      </span>
                      <span class="text-gray-500">Suite: <%= test_run.test_suite.name if test_run.test_suite %></span>
                      <span class="text-gray-500">Updated <%= time_ago_in_words(test_run.updated_at) %> ago</span>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>

    <!-- JUnit Uploads -->
    <% if @results[:junit_uploads].any? %>
      <div class="bg-white shadow-xl rounded-2xl overflow-hidden">
        <div class="bg-gradient-to-r from-amber-500 to-orange-600 px-6 py-4">
          <div class="flex items-center justify-between">
            <h2 class="text-xl font-bold text-white flex items-center">
              <svg class="h-6 w-6 mr-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
              </svg>
              JUnit Uploads (<%= @results[:junit_uploads].count %>)
            </h2>
            <%= link_to junit_uploads_path(search: @query), class: "bg-white/20 hover:bg-white/30 text-white px-3 py-1 rounded-lg text-sm font-medium transition-all duration-200" do %>
              View All →
            <% end %>
          </div>
        </div>
        <div class="p-6">
          <div class="space-y-4">
            <% @results[:junit_uploads].each do |upload| %>
              <div class="p-4 bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl hover:from-amber-100 hover:to-orange-100 transition-all duration-200 border border-amber-200">
                <div class="flex items-start justify-between">
                  <div class="flex-1">
                    <h3 class="font-semibold text-gray-900 mb-1">
                      <%= link_to upload.filename, junit_upload_path(upload), class: "hover:text-amber-600 transition-colors" %>
                    </h3>
                    <div class="flex items-center space-x-3 text-xs">
                      <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-800">
                        <%= upload.status %>
                      </span>
                      <span class="text-gray-500">Project: <%= upload.project_name %></span>
                      <span class="text-gray-500">Uploaded <%= time_ago_in_words(upload.uploaded_at) %> ago</span>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>

<% elsif @query.present? %>
  <!-- No Results -->
  <div class="text-center py-12">
    <svg class="mx-auto h-16 w-16 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
    </svg>
    <h3 class="text-lg font-medium text-gray-900 mb-2">No results found</h3>
    <p class="text-gray-500 mb-4">Sorry, we couldn't find anything matching "<span class="font-medium"><%= @query %></span>".</p>
    <div class="text-sm text-gray-400">
      <p>Try searching for:</p>
      <ul class="mt-2 space-y-1">
        <li>• Test case titles or descriptions</li>
        <li>• Test suite names</li>
        <li>• Test run names</li>
        <li>• JUnit upload filenames or project names</li>
      </ul>
    </div>
  </div>
<% end %>